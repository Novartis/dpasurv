<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The dpasurv package • dpasurv</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The dpasurv package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dpasurv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/dpa.html">The dpasurv package</a></li>
    <li><a class="dropdown-item" href="../articles/ggplot_demo.html">ggplot plotting functionality</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The dpasurv package</h1>
                        <h4 data-toc-skip class="author">Matthias
Kormaksson</h4>
            
            <h4 data-toc-skip class="date">July 10, 2024</h4>
      

      <div class="d-none name"><code>dpa.Rmd</code></div>
    </div>

    
    
<style>
.main-container {
  max-width: unset;
}
</style>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://opensource.nibr.com/dpasurv/">dpasurv</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Dynamic path analysis introduced by <span class="citation">(<a href="#ref-fosen">Fosen et al. 2006</a>)</span> is a method for
performing mediation analysis with a longitudinal mediator and
time-to-event outcome. A thorough review of the methodology can be found
in the tutorial paper of <span class="citation">(<a href="#ref-dpasurv">Kormaksson et al. 2024</a>)</span>. In this vignette
we will outline the modeling framework and define direct, indirect and
total effects in the context of dynamic path analysis. We then
demonstrate the the main functionalities of the package, namely
estimation, inference, and visualization.</p>
</div>
<div class="section level2">
<h2 id="methods">2. Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<div class="section level3">
<h3 id="dynamic-path-analysis">Dynamic path analysis<a class="anchor" aria-label="anchor" href="#dynamic-path-analysis"></a>
</h3>
<p>Dynamic path analysis involves modeling so-called <em>dynamic path
diagrams</em> such as the one depicted in Figure 1 (a). A dynamic path
diagram is defined in <span class="citation">(<a href="#ref-fosen">Fosen
et al. 2006</a>)</span> as a time-indexed sequence of directed acyclic
graphs that is characterized by a treatment variable, <span class="math inline">$\small Z$</span>, one or more longitudinal mediator
variables, <span class="math inline">$\small M(t)$</span>, and a
survival (time-to-event) outcome <span class="math inline">$\small
dN(t)=1(t \leq T &lt; t+dt)$</span>, where <span class="math inline">$\small T$</span> denotes the time of event with
hazard <span class="math inline">$\small \lambda(t) = \lim_{dt
\rightarrow 0} P(dN(t)=1 | T \geq t)$</span>. The survival outcome takes
the role of a single terminal node in the dynamic path diagram.
Additional time-fixed confounder variables, such as baseline
characteristics, <span class="math inline">$\small X$</span>, may be
incorporated as well.</p>
<div class="figure" style="text-align: center">
<img src="../reference/figures/tutorial_fig.png" alt="Figure 1. (a) A dynamic path diagram with treatment $\small Z$, a single mediator $\small M(t)$, and baseline confounders $\small X$; (b) Corresponding dynamic path diagram without the mediator process." width="630px"><p class="caption">
Figure 1. (a) A dynamic path diagram with treatment <span class="math inline">$\small Z$</span>, a single mediator <span class="math inline">$\small M(t)$</span>, and baseline confounders <span class="math inline">$\small X$</span>; (b) Corresponding dynamic path
diagram without the mediator process.
</p>
</div>
<p>Relationships between variables are represented by directed edges
between nodes and collectively the nodes and edges imply an underlying
model structure. More specifically, each child node represents an entity
to be modeled while the corresponding parent nodes represent the
underlying model covariates. In Figure 1 (a) there are two implied
models, one corresponding to the survival outcome variable, <span class="math inline">$\small dN(t)$</span>, and the other corresponding
to the mediator response <span class="math inline">$\small
M(t)$</span>.</p>
<p>A defining feature of dynamic path analysis as defined in <span class="citation">(<a href="#ref-fosen">Fosen et al. 2006</a>)</span> is
the specific choice of models for the dynamic path diagram, namely the
so-called <em>dynamic path models</em>. At the core of these is Aalen’s
additive regression model for the survival outcome at the terminal node
while all other models involve least squares regressions at each time
point <span class="math inline">$\small t$</span>. In the following
equations we see the dynamic path models corresponding to Figure 1 (a)
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">{</mo><msub><mi>β</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>Z</mi><mo>+</mo><msub><mi>β</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>M</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>X</mi><mi>η</mi><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>M</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>α</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>α</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>Z</mi><mo>+</mo><mi>X</mi><mi>η</mi><mo>+</mo><mi>ε</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
\lambda(t) &amp;= R(t) \cdot \left\{\beta_0(t) + \beta_1(t) Z + \beta_2(t) M(t) + X\eta \right\},  \tag{1} \\
M(t) &amp;= \alpha_0(t) + \alpha_1(t) Z + X\eta + \varepsilon(t).  \tag{2}
\end{align}</annotation></semantics></math> In the above <span class="math inline">$\small R(t)$</span> is the <em>at-risk</em>
function indicating whether subject is still under observation
(i.e. alive and still under follow up) just before time <span class="math inline">$\small t$</span>, and <span class="math inline">$\small \varepsilon(t)$</span> is a time-dependent
error term. Under the <em>outcome model</em> (1) the hazard is assumed
to change linearly as a function of treatment, mediator(s) and
confounders, while in the <em>mediator model</em> (2) the longitudinal
mediator is regressed on treatment and confounders.</p>
<p>The regression functions of principal interest are those
characterizing the relationships between treatment, mediator(s) and
survival, namely <span class="math inline">$\small \beta_1(t),
\beta_2(t)$</span>, and <span class="math inline">$\small
\alpha_1(t)$</span>. The goal of dynamic path analysis (and the dpasurv
package) is to estimate these key functions that serve as building
blocks for the direct, indirect and total effects that are defined in
the next section.</p>
</div>
<div class="section level3">
<h3 id="direct-indirect-and-total-effects">Direct, indirect and total effects<a class="anchor" aria-label="anchor" href="#direct-indirect-and-total-effects"></a>
</h3>
<p>The cumulative direct and indirect effects at time <span class="math inline">$\small t$</span> are defined as as follows
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>c</mi><mi>u</mi><mi>m</mi><mi>d</mi><mi>i</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><msub><mi>β</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>s</mi><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>c</mi><mi>u</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>d</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><msub><mi>α</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>β</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>s</mi><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
cumdir(t) &amp;= \int_0^t \beta_1(s)ds \label{eqn:direct_effect}, \\
cumind(t) &amp;= \int_0^t \alpha_1(s)\beta_2(s)ds \label{eqn:indirect_effect}.
\end{align}</annotation></semantics></math> The direct effect
corresponds to the regression function along the direct arrow between
treatment <span class="math inline">$\small Z$</span> and outcome <span class="math inline">$\small dN(t)$</span> in Figure 1 (a), while the
indirect effect is obtained by multiplying the regression functions
along the mediation path <span class="math inline">$\small Z \rightarrow
M(t) \rightarrow dN(t)$</span>.</p>
<p>The total effect is defined as the regression function <span class="math inline">$\small \gamma_1(t)$</span> from the mediator free
Aalen’s additive model from Figure 1 (b)
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">{</mo><msub><mi>γ</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>γ</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>Z</mi><mo>+</mo><mi>X</mi><mi>η</mi><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\lambda(t) = R(t) \cdot \left\{\gamma_0(t) + \gamma_1(t) Z + X\eta \right\}, \tag{3}
</annotation></semantics></math> and the corresponding cumulative total
effect is defined as:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>c</mi><mi>u</mi><mi>m</mi><mi>t</mi><mi>o</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><msub><mi>γ</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>s</mi><mi>.</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
cumtot(t) &amp;= \int_0^t \gamma_1(s)ds \label{eqn:total_effect}. \\
\end{align}</annotation></semantics></math> One of the most appealing
features of dynamic path analysis is the following analytical
decomposition
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>u</mi><mi>m</mi><mi>t</mi><mi>o</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>c</mi><mi>u</mi><mi>m</mi><mi>d</mi><mi>i</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>c</mi><mi>u</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>d</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
cumtot(t) = cumdir(t) + cumind(t).
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="estimation-and-inference">Estimation and inference<a class="anchor" aria-label="anchor" href="#estimation-and-inference"></a>
</h3>
<p>The analytical estimators for the cumulative direct, indirect, and
total effects above are derived in <span class="citation">(<a href="#ref-dpasurv">Kormaksson et al. 2024</a>)</span> and confidence
bands are obtained by bootstrap inference. More specifically, we
repeatedly sample subjects with replacement from the set of all subjects
and estimate the direct, indirect and total effects each time. Once we
have obtained <span class="math inline">$\small B$</span> bootstrap
estimates of the effects of interest, i.e. <span class="math inline">$\small (\widehat{cumdir}_b(t),
\widehat{cumind}_b(t), \widehat{cumtot}_b(t)$</span>), for <span class="math inline">$\small b=1,\dots,B$</span>, then we calculate
pointwise <span class="math inline">$\small 100\cdot(1-\alpha)$</span>%
bootstrap confidence intervals at each timepoint <span class="math inline">$\small t$</span> by calculating the corresponding
empirical <span class="math inline">$\small 100\cdot\alpha/2$</span> and
<span class="math inline">$\small 100\cdot(1-\alpha/2)$</span>
percentiles.</p>
</div>
</div>
<div class="section level2">
<h2 id="getting-started-with-dpasurv">3. Getting started with dpasurv<a class="anchor" aria-label="anchor" href="#getting-started-with-dpasurv"></a>
</h2>
<p>The dpasurv package implements the complete dynamic path analysis
workflow.</p>
<div class="section level3">
<h3 id="simulated-data-set">Simulated data set<a class="anchor" aria-label="anchor" href="#simulated-data-set"></a>
</h3>
<p>The dpasurv package comes with a simulated data set called
<code>simdata</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simdata</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,229 × 7</span></span></span>
<span><span class="co">#&gt;    subject     x dose      M start  stop event</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1           0 ctrl   6.74     0   4       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1           0 ctrl   6.91     4   8       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1           0 ctrl   6.9      8  12       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1           0 ctrl   6.71    12  26       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1           0 ctrl   6.45    26  46.8     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2           1 high   6.11     0   4       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2           1 high   6.28     4   8       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2           1 high   7.04     8  12       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2           1 high   6.93    12  26       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2           1 high   7.86    26  52       0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,219 more rows</span></span></span></code></pre></div>
<p>The data contains the following variables:</p>
<ul>
<li>
<em>subject:</em> Subject ID</li>
<li>
<em>x:</em> Binary treatment covariate (0 for control, 1 for
treated)</li>
<li>
<em>dose:</em> Underlying dose (ctrl, low, high)</li>
<li>
<em>M:</em> Longitudinal mediator measurement</li>
<li>
<em>start:</em> Visiting times at which the mediator value is
measured</li>
<li>
<em>stop:</em> Time that either marks the beginning of the next
visit, or censoring (if event=0). Alternatively it marks the time of
event (if event=1)</li>
<li>
<em>event:</em> Binary event indicator</li>
</ul>
<p>At each visiting time, start, a new mediator measurement is taken.
However, the mathematical assumption is that the intervals (start,stop]
are open on the left and closed on the right, which means that the value
of the mediator M for subject 1 at week 4 is taken to be 6.74. Under
this assumption the risk of an event in the interval (start, stop] is
influenced by the last observed mediator value.</p>
</div>
<div class="section level3">
<h3 id="implementation-in-a-nutshell">Implementation in a nutshell<a class="anchor" aria-label="anchor" href="#implementation-in-a-nutshell"></a>
</h3>
<p>Below we see the minimal code required for performing dynamic path
analysis on <code>simdata</code>. It explores the direct effect of x on
survival as well as the indirect effect mediated through M:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform dynamic path analysis</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dpa.html">dpa</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">M</span> <span class="op">+</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">M</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, id <span class="op">=</span> <span class="st">"subject"</span>, data <span class="op">=</span> <span class="va">simdata</span>, boot.n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract cumulative direct and indirect effects with 95% pointwise bootstrap confidence bands:</span></span>
<span><span class="va">direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/effect.html">effect</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">outcome</span>, <span class="va">s</span>, alpha<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">indirect</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/effect.html">effect</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">M</span> <span class="op">~</span> <span class="va">outcome</span>, <span class="va">s</span>, alpha<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use sum() method to obtain total effect</span></span>
<span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">direct</span>, <span class="va">indirect</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">direct</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">indirect</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the results with ggplot2 graphics:</span></span>
<span><span class="fu"><a href="../reference/ggplot.effect.html">ggplot.effect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">direct</span>, <span class="va">indirect</span>, <span class="va">total</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="simulated-use-case">4. Simulated Use Case<a class="anchor" aria-label="anchor" href="#simulated-use-case"></a>
</h2>
<p>Let us now use the dpasurv package to perform a slightly more in
depth analysis of <code>simdata</code>.</p>
<div class="section level3">
<h3 id="look-at-the-data">Look at the data<a class="anchor" aria-label="anchor" href="#look-at-the-data"></a>
</h3>
<p>Firstly, we note that there is a dose response trend when looking at
longitudinal trends in the subject mediator profiles:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">start</span>, y <span class="op">=</span> <span class="va">M</span>, group<span class="op">=</span><span class="va">dose</span>, colour<span class="op">=</span><span class="va">dose</span><span class="op">)</span>, data<span class="op">=</span><span class="va">simdata</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="dpa_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>The higher the dose, the higher the average mediator value is.</p>
<p>We also note that there is a dose response trend when looking at
association between dose levels and survival</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">dose</span>, data<span class="op">=</span><span class="va">simdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, xlab<span class="op">=</span><span class="st">"Time"</span>, ylab<span class="op">=</span><span class="st">"Survival"</span>, main<span class="op">=</span><span class="st">"KM-curves by dose level"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"low dose"</span>, <span class="st">"high dose"</span><span class="op">)</span>,</span>
<span>col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, lwd<span class="op">=</span><span class="fl">2</span>, bty<span class="op">=</span><span class="st">'n'</span><span class="op">)</span></span></code></pre></div>
<p><img src="dpa_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
<p>A Cox model with dose and mediator as covariates reveals a
significant hazard ratio for high dose, but only a trend for the low
dose (both as compared to control), while there is no significant
association between the mediator and survival:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">dose</span> <span class="op">+</span> <span class="va">M</span>, data<span class="op">=</span><span class="va">simdata</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(start, stop, event) ~ dose + M, data = simdata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 1229, number of events= 172 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              coef exp(coef) se(coef)      z Pr(&gt;|z|)   </span></span>
<span><span class="co">#&gt; doselow  -0.32281   0.72411  0.18826 -1.715  0.08640 . </span></span>
<span><span class="co">#&gt; dosehigh -0.66230   0.51566  0.20542 -3.224  0.00126 **</span></span>
<span><span class="co">#&gt; M         0.05274   1.05416  0.04863  1.085  0.27808   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; doselow     0.7241     1.3810    0.5007    1.0473</span></span>
<span><span class="co">#&gt; dosehigh    0.5157     1.9392    0.3448    0.7713</span></span>
<span><span class="co">#&gt; M           1.0542     0.9486    0.9583    1.1596</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.555  (se = 0.025 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 10.57  on 3 df,   p=0.01</span></span>
<span><span class="co">#&gt; Wald test            = 10.51  on 3 df,   p=0.01</span></span>
<span><span class="co">#&gt; Score (logrank) test = 10.7  on 3 df,   p=0.01</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dynamic-path-analysis-1">Dynamic path analysis<a class="anchor" aria-label="anchor" href="#dynamic-path-analysis-1"></a>
</h3>
<p>Let’s now perform dynamic path analysis with the <code><a href="../reference/dpa.html">dpa()</a></code>
function</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dpa.html">dpa</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">M</span> <span class="op">+</span> <span class="va">dose</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">M</span> <span class="op">~</span> <span class="va">dose</span><span class="op">)</span>, id <span class="op">=</span> <span class="st">"subject"</span>, data <span class="op">=</span> <span class="va">simdata</span>, boot.n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p>and calculate some effects of interest with the <code><a href="../reference/effect.html">effect()</a></code>
function.</p>
<p>We confirm a dose response on mediator, which appears significant for
the high-dose vs control:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The dose effect on mediator response:</span></span>
<span><span class="va">dose.on.mediator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/effect.html">effect</a></span><span class="op">(</span><span class="va">dose</span> <span class="op">~</span> <span class="va">M</span>, <span class="va">s</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggplot.effect.html">ggplot.effect</a></span><span class="op">(</span><span class="va">dose.on.mediator</span><span class="op">)</span></span></code></pre></div>
<p><img src="dpa_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>We also confirm a dose response on survival outcome, although only
the high-dose appears significant:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># direct effect of dose on outcome</span></span>
<span><span class="va">direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/effect.html">effect</a></span><span class="op">(</span><span class="va">dose</span> <span class="op">~</span> <span class="va">outcome</span>, <span class="va">s</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggplot.effect.html">ggplot.effect</a></span><span class="op">(</span><span class="va">direct</span><span class="op">)</span></span></code></pre></div>
<p><img src="dpa_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>In contrast to the conclusions from the Cox-model there appears to be
a meaningful dynamic association between the mediator and survival:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># effect of mediator on outcome</span></span>
<span><span class="va">mediator.on.outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/effect.html">effect</a></span><span class="op">(</span><span class="va">M</span> <span class="op">~</span> <span class="va">outcome</span>, <span class="va">s</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggplot.effect.html">ggplot.effect</a></span><span class="op">(</span><span class="va">mediator.on.outcome</span><span class="op">)</span></span></code></pre></div>
<p><img src="dpa_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>In particular, the mediator effect is neutral for the first 100 days
and then starts having a significant detrimental effect on survival
after that (the higher the mediator value, the higher the risk).</p>
</div>
<div class="section level3">
<h3 id="explore-output-of-aalens-additive-model">Explore output of Aalen’s additive model<a class="anchor" aria-label="anchor" href="#explore-output-of-aalens-additive-model"></a>
</h3>
<p>The output object from the call to the <code><a href="../reference/dpa.html">dpa()</a></code> function
above stores the output from Aalen’s additive model (1) and we can
explore its content for inferential purposes</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Output from Aalen's additive model from the timereg::aalen() implementation:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">aalen</span><span class="op">)</span></span>
<span><span class="co">#&gt; Additive Aalen Model </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test for nonparametric terms </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test for non-significant effects </span></span>
<span><span class="co">#&gt;             Supremum-test of significance p-value H_0: B(t)=0</span></span>
<span><span class="co">#&gt; (Intercept)                          2.56               0.163</span></span>
<span><span class="co">#&gt; M                                    3.30               0.025</span></span>
<span><span class="co">#&gt; doselow                              2.99               0.061</span></span>
<span><span class="co">#&gt; dosehigh                             5.12               0.000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test for time invariant effects </span></span>
<span><span class="co">#&gt;                   Kolmogorov-Smirnov test p-value H_0:constant effect</span></span>
<span><span class="co">#&gt; (Intercept)                         1.400                       0.023</span></span>
<span><span class="co">#&gt; M                                   0.176                       0.066</span></span>
<span><span class="co">#&gt; doselow                             0.595                       0.473</span></span>
<span><span class="co">#&gt; dosehigh                            0.587                       0.534</span></span>
<span><span class="co">#&gt;                     Cramer von Mises test p-value H_0:constant effect</span></span>
<span><span class="co">#&gt; (Intercept)                        148.00                       0.008</span></span>
<span><span class="co">#&gt; M                                    2.05                       0.072</span></span>
<span><span class="co">#&gt; doselow                             14.90                       0.530</span></span>
<span><span class="co">#&gt; dosehigh                            13.30                       0.623</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    </span></span>
<span><span class="co">#&gt;    </span></span>
<span><span class="co">#&gt;   Call: </span></span>
<span><span class="co">#&gt; timereg::aalen(formula = out.formula, data = data, id = data[[id]])</span></span></code></pre></div>
<p>According to the resampling tests of the time-varying effects we see
that the mediator effect is indeed significantly different from zero as
well as the high-dose effect, while the low-dose effect is only
marginally significant.</p>
</div>
<div class="section level3">
<h3 id="plot-the-direct-indirect-and-total-effects">Plot the direct, indirect, and total effects<a class="anchor" aria-label="anchor" href="#plot-the-direct-indirect-and-total-effects"></a>
</h3>
<p>Finally, let’s also calculate the indirect and total effects</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># indirect effect of dose on outcome, mediated through M</span></span>
<span><span class="va">indirect</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/effect.html">effect</a></span><span class="op">(</span><span class="va">dose</span> <span class="op">~</span> <span class="va">M</span> <span class="op">~</span> <span class="va">outcome</span>, <span class="va">s</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># total effect</span></span>
<span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">direct</span>, <span class="va">indirect</span><span class="op">)</span></span></code></pre></div>
<p>and then plot together the direct, indirect, and total effects:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplot.effect.html">ggplot.effect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">direct</span>, <span class="va">indirect</span>, <span class="va">total</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="dpa_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>We see that the indirect effect of dose on survival is neutral for
the first 100 days but then becomes detrimental for survival after that
(only significant for the high dose). The detrimental indirect effect of
the high dose counteracts the corresponding significant and beneficial
direct effect.</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-fosen" class="csl-entry">
Fosen, J., E. Ferkingstad, Ø. Borgan, and O. O. Aalen. 2006.
<span>“Dynamic Path Analysis - a New Approach to Analyzing
Time-Dependent Covariates.”</span> <em>Lifetime Data Anal.</em> 12 (2):
143–67. <a href="https://doi.org/10.1007/s10985-006-9004-2" class="external-link">https://doi.org/10.1007/s10985-006-9004-2</a>.
</div>
<div id="ref-dpasurv" class="csl-entry">
Kormaksson, M., M. R. Lange, D. Demanse, S. Strohmaier, J. Duan, Q. Xie,
M. Carbini, C. Bossen, A. Guettner, and A. Maniero. 2024. <span>“Dynamic
Path Analysis for Exploring Treatment Effect Mediation Processes in
Clinical Trials with Time-to-Event Endpoints.”</span>
<em>(Submitted)</em>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthias Kormaksson, Susanne Strohmaier, Markus Lange, David Demanse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
