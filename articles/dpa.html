<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dpasurv">
<title>The dpasurv package • dpasurv</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The dpasurv package">
<meta property="og:description" content="dpasurv">
<meta property="og:image" content="http://opensource.nibr.com/dpasurv/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dpasurv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dpa.html">The dpasurv package</a>
    <a class="dropdown-item" href="../articles/ggplot_demo.html">ggplot plotting functionality</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The dpasurv package</h1>
                        <h4 data-toc-skip class="author">Matthias
Kormaksson</h4>
            
            <h4 data-toc-skip class="date">July 06, 2024</h4>
      
      
      <div class="d-none name"><code>dpa.Rmd</code></div>
    </div>

    
    
<style>
.main-container {
  max-width: unset;
}
</style>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://opensource.nibr.com/dpasurv/">dpasurv</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Dynamic path analysis introduced by <span class="citation">(<a href="#ref-fosen">Fosen et al. 2006</a>)</span> is a method for
performing mediation analysis with a longitudinal mediator and
time-to-event outcome. A thorough review of the methodology can be found
in the tutorial paper of <span class="citation">(<a href="#ref-dpasurv">Kormaksson et al. 2024</a>)</span>. In this vignette
we will outline the modeling framework and define direct, indirect and
total effects in the context of dynamic path analysis. We then
demonstrate the the main functionalities of the package, namely
estimation, inference, and visualization.</p>
</div>
<div class="section level2">
<h2 id="methods">2. Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<div class="section level3">
<h3 id="dynamic-path-analysis">Dynamic path analysis<a class="anchor" aria-label="anchor" href="#dynamic-path-analysis"></a>
</h3>
<p>Dynamic path analysis involves modeling so-called <em>dynamic path
diagrams</em> such as the one depicted in Figure 1. A dynamic path
diagrams is defined in <span class="citation">(<a href="#ref-fosen">Fosen et al. 2006</a>)</span> as a time-indexed
sequence of directed acyclic graphs that is characterized by a treatment
variable, <span class="math inline">\(\small X\)</span>, one or more
longitudinal mediator variables, <span class="math inline">\(\small
M(t)\)</span>, and a survival (time-to-event) outcome with hazard <span class="math inline">\(\small \lambda(t)\)</span> that takes the role of
a single terminal node in the dynamic path diagram. Additional
time-fixed confounder variables, such as baseline characteristics, <span class="math inline">\(\small C\)</span>, may be incorporated as
well.</p>
<div class="figure" style="text-align: center">
<img src="../reference/figures/simple_dag.png" alt="Figure 1. A simple dynamic path diagram with treatment $\small X$, a single mediator $\small M(t)$, and confounders $\small C$." width="200px"><p class="caption">
Figure 1. A simple dynamic path diagram with treatment <span class="math inline">\(\small X\)</span>, a single mediator <span class="math inline">\(\small M(t)\)</span>, and confounders <span class="math inline">\(\small C\)</span>.
</p>
</div>
<p>Relationships between variables are represented by directed edges
between nodes and collectively the nodes and edges imply an underlying
model structure. More specifically, each child node represents an entity
to be modeled while the corresponding parent nodes represent the
underlying model covariates. In Figure 1 there are two implied models,
one corresponding to the hazard <span class="math inline">\(\small
\lambda(t)\)</span> of the time-to-event outcome, and the other
corresponding to the mediator response <span class="math inline">\(\small M(t)\)</span>.</p>
<p>A defining feature of dynamic path analysis as defined in <span class="citation">(<a href="#ref-fosen">Fosen et al. 2006</a>)</span> is
the specific choice of models for the dynamic path diagram, namely the
so-called <em>dynamic path models</em>. At the core of these is Aalen’s
additive regression model for the survival outcome at the terminal node
while all other models involve least squares regressions at each time
point <span class="math inline">\(t\)</span>. In the following equations
we see the dynamic path models corresponding to Figure 1: <span class="math display">\[\begin{align}
\lambda(t) &amp;= R(t) \cdot \left\{\beta_0(t) + \beta_1(t) X +
\beta_2(t) M(t) + C\eta \right\},  \tag{1} \\
M(t) &amp;= \alpha_0(t) + \alpha_1(t) X + C\eta +
\varepsilon(t).  \tag{2}
\end{align}\]</span> In the above <span class="math inline">\(\small
R(t)\)</span> is the <em>at-risk</em> function indicating whether
subject is still under observation (i.e. alive and still under follow
up) just before time <span class="math inline">\(\small t\)</span>, and
<span class="math inline">\(\small \varepsilon(t)\)</span> is a
time-dependent error term. Under the <em>outcome model</em> (1) the
hazard is assumed to change linearly as a function of treatment,
mediator(s) and confounders, while in the <em>mediator model</em> (2)
the longitudinal mediator is regressed on treatment and confounders.</p>
<p>The regression functions of principal interest are those
characterizing the relationships between treatment, mediator(s) and
survival, namely <span class="math inline">\(\small \beta_1(t),
\beta_2(t)\)</span>, and <span class="math inline">\(\small
\alpha_1(t)\)</span>. The goal of dynamic path analysis (and the
<code>dpasurv</code> package) is to estimate these key functions that
serve as building blocks for the direct, indirect and total effects that
are defined in the next section.</p>
</div>
<div class="section level3">
<h3 id="direct-indirect-and-total-effects">Direct, indirect and total effects<a class="anchor" aria-label="anchor" href="#direct-indirect-and-total-effects"></a>
</h3>
<p>The cumulative direct and indirect effects at time <span class="math inline">\(t\)</span> are defined as as follows: <span class="math display">\[\begin{align}
cumdir(t) &amp;= \int_0^t \beta_1(s)ds \label{eqn:direct_effect}, \\
cumind(t) &amp;= \int_0^t \alpha_1(s)\beta_2(s)ds
\label{eqn:indirect_effect}.
\end{align}\]</span> The total effect is defined as the regression
function <span class="math inline">\(\gamma_1(t)\)</span> from the
mediator free Aalen’s additive model: <span class="math display">\[
\lambda(t) = R(t) \cdot \left\{\gamma_0(t) + \gamma_1(t) X + C\eta
\right\}, \tag{3}
\]</span> and the corresponding cumulative total effect is defined as:
<span class="math display">\[\begin{align}
cumtot(t) &amp;= \int_0^t \gamma_1(s)ds \label{eqn:total_effect}. \\
\end{align}\]</span> One of the most appealing features of dynamic path
analysis is the following analytical decomposition: <span class="math display">\[
cumtot(t) = cumdir(t) + cumind(t)
\]</span></p>
</div>
<div class="section level3">
<h3 id="estimation-and-inference">Estimation and inference<a class="anchor" aria-label="anchor" href="#estimation-and-inference"></a>
</h3>
<p>The analytical estimators for the cumulative direct, indirect, and
total effects above are derived in <span class="citation">(<a href="#ref-dpasurv">Kormaksson et al. 2024</a>)</span> and confidence
bands are obtained by bootstrap inference. More specifically, we
repeatedly sample subjects with replacement from the set of all subjects
and estimate the direct, indirect and total effects each time. Once we
have obtained <span class="math inline">\(B\)</span> bootstrap estimates
of the effects of interest, i.e. <span class="math inline">\((\widehat{cumdir}_b(t), \widehat{cumind}_b(t),
\widehat{cumtot}_b(t)\)</span>), for <span class="math inline">\(b=1,\dots,B\)</span>, then we calculate pointwise
<span class="math inline">\(100\cdot(1-\alpha)\)</span>% bootstrap
confidence intervals at each timepoint <span class="math inline">\(t\)</span> by calculating the corresponding
empirical <span class="math inline">\(100\cdot\alpha/2\)</span> and
<span class="math inline">\(100\cdot(1-\alpha/2)\)</span>
percentiles.</p>
</div>
</div>
<div class="section level2">
<h2 id="implementation">3. Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h2>
<p>The <code>dpasurv</code> package implements the complete dynamic path
analysis workflow.</p>
<div class="section level3">
<h3 id="fitting-the-dynamic-path-model">Fitting the dynamic path model<a class="anchor" aria-label="anchor" href="#fitting-the-dynamic-path-model"></a>
</h3>
<p>The following code fits a dynamic path model aimed at evaluating
potential mediation of the effect of treatment <code>x</code> through a
longitudinal mediator <code>M</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dpa.html">dpa</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">M</span> <span class="op">+</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">M</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, id <span class="op">=</span> <span class="st">"subject"</span>, data <span class="op">=</span> <span class="va">simdata</span>, boot.n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimating-direct-indirect-and-total-effects">Estimating direct, indirect and total effects<a class="anchor" aria-label="anchor" href="#estimating-direct-indirect-and-total-effects"></a>
</h3>
<p>Once the dynamic path models have been fitted, the user can extract
direct and indirect effects with the <code><a href="../reference/effect.html">effect()</a></code> function</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/effect.html">effect</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">outcome</span>, <span class="va">s</span>, alpha<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">indirect</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/effect.html">effect</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">M</span> <span class="op">~</span> <span class="va">outcome</span>, <span class="va">s</span>, alpha<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<p>The outputs above (<code>direct</code> and <code>indirect</code>) are
both objects of class <code>"effect"</code> and they can be summed
together via the <code>sum</code> method to obtain the total effect</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">direct</span>, <span class="va">indirect</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-effects">Plotting effects<a class="anchor" aria-label="anchor" href="#plotting-effects"></a>
</h3>
<p>The <code>plot</code> method for objects of class
<code>"effect"</code> can be used to quickly visualize the estimated
effects along with confidence bands.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">direct</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">indirect</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, the user may plot all of the effects in a single plot
using ggplot2 graphics:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ggplot.effect.html">ggplot.effect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">direct</span>, <span class="va">indirect</span>, <span class="va">total</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>See the ggplot_demo.html vignette for further details.</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-fosen" class="csl-entry">
Fosen, J., E. Ferkingstad, Ø. Borgan, and O. O. Aalen. 2006.
<span>“Dynamic Path Analysis - a New Approach to Analyzing
Time-Dependent Covariates.”</span> <em>Lifetime Data Anal.</em> 12 (2):
143–67. <a href="https://doi.org/10.1007/s10985-006-9004-2" class="external-link">https://doi.org/10.1007/s10985-006-9004-2</a>.
</div>
<div id="ref-dpasurv" class="csl-entry">
Kormaksson, M., M. R. Lange, D. Demanse, S. Strohmaier, J. Duan, Q. Xie,
M. Carbini, C. Bossen, A. Guettner, and A. Maniero. 2024. <span>“Dynamic
Path Analysis for Exploring Treatment Effect Mediation Processes in
Clinical Trials with Time-to-Event Endpoints.”</span>
<em>(Submitted)</em>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthias Kormaksson, Susanne Strohmaier, Markus Lange, David Demanse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
